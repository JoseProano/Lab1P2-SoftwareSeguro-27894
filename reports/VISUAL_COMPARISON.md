## ğŸ“Š ComparaciÃ³n Visual de Reportes

### Resumen Ejecutivo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EVOLUCIÃ“N DEL SCANNER                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Scanner Original                                               â”‚
â”‚  â”œâ”€ 238 detecciones                                             â”‚
â”‚  â”œâ”€ 235 CWE-Unknown (98.7%) âŒ                                  â”‚
â”‚  â””â”€ PrecisiÃ³n: ~1.3%                                            â”‚
â”‚                                                                 â”‚
â”‚                    â†“ BigVul Training (25,738 CVEs)              â”‚
â”‚                                                                 â”‚
â”‚  Scanner BigVul v1                                              â”‚
â”‚  â”œâ”€ 20 detecciones                                              â”‚
â”‚  â”œâ”€ 0 CWE-Unknown âœ…                                            â”‚
â”‚  â”œâ”€ 16 falsos positivos (80%) âŒ                                â”‚
â”‚  â””â”€ PrecisiÃ³n: ~20%                                             â”‚
â”‚                                                                 â”‚
â”‚                    â†“ Context-Aware Filtering                    â”‚
â”‚                                                                 â”‚
â”‚  Scanner Mejorado v3 (FINAL)                                    â”‚
â”‚  â”œâ”€ 1 detecciÃ³n                                                 â”‚
â”‚  â”œâ”€ 0 CWE-Unknown âœ…                                            â”‚
â”‚  â”œâ”€ 0 falsos positivos (0%) âœ…                                  â”‚
â”‚  â””â”€ PrecisiÃ³n: 100% âœ…                                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Detecciones por VersiÃ³n

```
Original (238)   BigVul v1 (20)   Mejorado v3 (1)
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ             â–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ             
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ             Leyenda:
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ             â–ˆ = Falso Positivo
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ             â–ˆ = Verdadero Positivo
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ             
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ             
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ             
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ             
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ             
```

---

### DistribuciÃ³n CWE

#### Scanner BigVul v1 (20 detecciones)
```
CWE-79 (XSS)              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 11 (55%)  â† 10 falsos positivos
CWE-798 (Hard-coded)      â–ˆâ–ˆâ–ˆâ–ˆ 4 (20%)         â† 3 falsos positivos
CWE-502 (Deserialization) â–ˆâ–ˆ 2 (10%)           â† 2 falsos positivos
CWE-611 (XXE)             â–ˆ 1 (5%)             â† 1 falso positivo
CWE-22 (Path Traversal)   â–ˆ 1 (5%)             â† 1 falso positivo
CWE-94 (Code Injection)   â–ˆ 1 (5%)             â† 1 falso positivo
CWE-89 (SQL Injection)    0 âŒ                  â† Clasificado como CWE-502
```

#### Scanner Mejorado v3 (1 detecciÃ³n)
```
CWE-89 (SQL Injection)    â–ˆ 1 (100%) âœ…         â† LegÃ­timo
```

---

### False Positive Rate

```
100% â”‚                                                          
     â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                              
 80% â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â”‚                              
     â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ       â”‚                              
 60% â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ         â”‚                              
     â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ           â”‚                              
 40% â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ             â”‚                              
     â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ               â”‚                              
 20% â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                 â”‚                              
     â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                   â”‚       â–ˆâ–ˆâ–ˆâ–ˆ                   
  0% â”‚ â–ˆâ–ˆâ–ˆâ–ˆ                     â”‚       â–ˆâ–ˆ                     
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 
        Original (98.7%)      BigVul v1 (80%)    Mejorado v3 (0%)
```

---

### Archivos Filtrados (False Positives Eliminados)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Config.java                                            â”‚
â”‚ â”œâ”€ Antes: XSS (99.9% confidence) âŒ                    â”‚
â”‚ â””â”€ DespuÃ©s: Filtrado (Spring @Configuration) âœ…        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ UserService.java                                       â”‚
â”‚ â”œâ”€ Antes: Path Traversal (86% confidence) âŒ           â”‚
â”‚ â””â”€ DespuÃ©s: Filtrado (JPA Repository) âœ…               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IndexController.java                                   â”‚
â”‚ â”œâ”€ Antes: XSS (100% confidence) âŒ                     â”‚
â”‚ â””â”€ DespuÃ©s: Filtrado (model.addAttribute) âœ…           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Item.java                                              â”‚
â”‚ â”œâ”€ Antes: XSS (98.3% confidence) âŒ                    â”‚
â”‚ â””â”€ DespuÃ©s: Filtrado (Safe getter) âœ…                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PayloadController.java                                 â”‚
â”‚ â”œâ”€ Antes: XSS (99.9% confidence) âŒ                    â”‚
â”‚ â””â”€ DespuÃ©s: Filtrado (Closing brace) âœ…                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
... y 14 archivos mÃ¡s
```

---

### Vulnerabilidad Real Detectada âœ…

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  ğŸ”´ CRITICAL SQL INJECTION                    â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ File: UserSearchService.java                                  â•‘
â•‘ Lines: 30-36                                                  â•‘
â•‘ CWE: CWE-89                                                   â•‘
â•‘ Confidence: 95%                                               â•‘
â•‘ Method: Pattern-based detection                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Code:                                                         â•‘
â•‘ String query = "select ... where name like '%" +              â•‘
â•‘         search.getSearchText() + "%'";                        â•‘
â•‘                                                               â•‘
â•‘ ResultSet rs = connection.createStatement()                   â•‘
â•‘                          .executeQuery(query);                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Impact:                                                       â•‘
â•‘ â€¢ SQL Injection via search parameter                          â•‘
â•‘ â€¢ Potential data exfiltration from public.user table          â•‘
â•‘ â€¢ Authentication bypass possible                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ Fix:                                                          â•‘
â•‘ PreparedStatement stmt = connection.prepareStatement(         â•‘
â•‘     "select ... where name like ?"                            â•‘
â•‘ );                                                            â•‘
â•‘ stmt.setString(1, "%" + search.getSearchText() + "%");        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

### MÃ©tricas Comparativas

| MÃ©trica | Original | BigVul v1 | Mejorado v3 |
|---------|----------|-----------|-------------|
| **Detecciones Totales** | 238 | 20 | 1 |
| **Verdaderos Positivos** | 3 | 4 | 1 |
| **Falsos Positivos** | 235 | 16 | 0 |
| **PrecisiÃ³n** | 1.3% | 20% | **100%** âœ… |
| **False Positive Rate** | 98.7% | 80% | **0%** âœ… |
| **CWE-Unknown** | 98.7% | 0% | **0%** âœ… |
| **CWE Accuracy** | N/A | 25% (SQLâ†’Deser) | **100%** âœ… |

---

### Timeline de Desarrollo

```
DÃ­a 1: Scanner Original
â”‚
â”œâ”€ Problema: 238 detecciones, 98.7% CWE-Unknown
â”‚
DÃ­a 2: ImplementaciÃ³n BigVul
â”‚
â”œâ”€ Mining: 25,738 CVEs procesados
â”œâ”€ Dataset: 1,000 samples balanceados
â”œâ”€ Training: Dual-model (Binary + CWE)
â”œâ”€ Result: 100% test accuracy
â”‚
DÃ­a 3: Testing en JavaSpringVulny
â”‚
â”œâ”€ Resultado: 20 detecciones, 0% CWE-Unknown âœ…
â”œâ”€ Problema: 80% false positives âŒ
â”œâ”€ ClasificaciÃ³n incorrecta: SQL â†’ CWE-502 âŒ
â”‚
DÃ­a 4: Context-Aware Filtering
â”‚
â”œâ”€ Pre-filtros: Spring config, JPA entities, templates
â”œâ”€ Pattern-based: SQL/Command injection detection
â”œâ”€ ML threshold: 0.5 â†’ 0.7
â”œâ”€ Resultado: 11 detecciones, ~18% precisiÃ³n
â”‚
DÃ­a 5: Refinamiento Final
â”‚
â”œâ”€ Filtros adicionales: chunks vacÃ­os, getters, braces
â”œâ”€ Resultado: 1 detecciÃ³n, 100% precisiÃ³n âœ…
â”‚
â””â”€ âœ… COMPLETADO
```

---

### TecnologÃ­as Utilizadas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dataset & Training                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ NVD CVE Database (34,952 JSON files)                  â”‚
â”‚ â€¢ BigVul-style generation (1,000 balanced samples)      â”‚
â”‚ â€¢ GradientBoostingClassifier (binary detection)         â”‚
â”‚ â€¢ RandomForestClassifier (10-class CWE)                 â”‚
â”‚ â€¢ TF-IDF Vectorization (5,000 char n-grams)             â”‚
â”‚ â€¢ AST Feature Extraction (28 structural features)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Scanner Architecture                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Hybrid Detection (Pattern + ML)                       â”‚
â”‚ â€¢ Framework-Aware Filtering (Spring Boot, JPA)          â”‚
â”‚ â€¢ Context-Based Pre-filtering                           â”‚
â”‚ â€¢ Regex Pattern Matching for Critical CVEs              â”‚
â”‚ â€¢ Confidence Threshold Tuning (0.7 for production)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Lecciones Clave

```
âŒ ML Puro No Es Suficiente
   â€¢ 100% accuracy en test â‰  100% en producciÃ³n
   â€¢ Synthetic data no refleja frameworks reales
   
âœ… Framework Awareness Es CrÃ­tico
   â€¢ Spring Boot: model.addAttribute(), @Bean, @Configuration
   â€¢ JPA: @Entity, @Repository patterns
   â€¢ Templates: Thymeleaf rendering seguro
   
âœ… Hybrid Approach Funciona
   â€¢ Whitelist: Filtrar patrones conocidos como seguros
   â€¢ Blacklist: Pattern matching para crÃ­ticos (SQL, Command)
   â€¢ ML: Solo para casos ambiguos
   
âœ… Context Matters
   â€¢ Chunks de 20 lÃ­neas pueden perder contexto
   â€¢ Filtrar cÃ³digo vacÃ­o/braces/getters es esencial
   â€¢ Threshold alto (0.7) reduce ruido dramÃ¡ticamente
```
